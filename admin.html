<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>管理后台</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#f5f5f5;padding-bottom:60px;font-family:system-ui}
.tab-bar{display:flex;background:#fff;border-bottom:1px solid #eee}
.tab{flex:1;text-align:center;padding:14px 0;font-weight:500;cursor:pointer}
.tab.active{color:#ff6b9d}
.page{display:none;padding:10px}
.page.active{display:block}
.card{background:#fff;border-radius:12px;padding:16px;margin-bottom:10px}
input,textarea,button{width:100%;margin:6px 0;padding:12px;border-radius:8px;border:1px solid #ddd}
button{background:#ff6b9d;color:white;border:none}
.del{background:#ff4444;margin-top:8px}
</style>
</head>
<body>

<div class="tab-bar">
  <div class="tab active" onclick="tab(0)">发动态</div>
  <div class="tab" onclick="tab(1)">资料设置</div>
  <div class="tab" onclick="tab(2)">动态管理</div>
</div>

<div class="page active" id="p0">
  <div class="card">
    <textarea id="text" placeholder="文字内容"></textarea>
    <input type="url" id="imgurl" placeholder="粘贴图片网络地址">
    <input type="url" id="vidurl" placeholder="粘贴视频网络地址">
    <button onclick="post()">发布动态</button>
  </div>
</div>

<div class="page" id="p1">
  <div class="card">
    <input id="name" placeholder="昵称">
    <input id="height" placeholder="身高">
    <input id="age" placeholder="年龄">
    <input id="size" placeholder="尺寸">
    <button onclick="saveProfile()">保存资料</button>
  </div>
</div>

<div class="page" id="p2">
  <div id="postManage"></div>
</div>

<script>
const API = "https://jsonblob.com/api/jsonBlob/1186156893246906368";
let currentData = { posts:[], user:{} };

function tab(i){
  document.querySelectorAll('.tab').forEach((t,j)=>t.classList.toggle('active',j==i));
  document.querySelectorAll('.page').forEach((p,j)=>p.classList.toggle('active',j==i));
  if(i==2) loadManage();
}

async function loadData() {
  const r = await fetch(API);
  currentData = await r.json() || { posts:[], user:{} };
}

async function post() {
  const txt = document.getElementById('text').value;
  const img = document.getElementById('imgurl').value;
  const vid = document.getElementById('vidurl').value;
  await loadData();

  const p = {
    txt,
    type: img ? 'img' : vid ? 'vid' : '',
    url: img || vid || '',
    time: Date.now()
  };

  currentData.posts.unshift(p);
  await fetch(API, {
    method: 'PUT',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(currentData)
  });
  alert('发布成功！全世界都能看见了！');
}

async function saveProfile() {
  await loadData();
  currentData.user = {
    name: document.getElementById('name').value,
    height: document.getElementById('height').value,
    age: document.getElementById('age').value,
    size: document.getElementById('size').value
  };
  await fetch(API, {
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(currentData)
  });
  alert('资料保存成功');
}

async function loadManage() {
  await loadData();
  const pm = document.getElementById('postManage');
  pm.innerHTML = '';
  currentData.posts.forEach((p,idx)=>{
    const c = document.createElement('div');
    c.className='card';
    c.innerText = p.txt || '';
    if(p.type==='img'&&p.url){
      const img=document.createElement('img');
      img.src=p.url;img.style.width='100%';img.style.borderRadius='8px';img.style.marginTop='8px';
      c.appendChild(img);
    }
    if(p.type==='vid'&&p.url){
      const v=document.createElement('video');
      v.src=p.url;v.controls=true;v.style.width='100%';img.style.marginTop='8px';
      c.appendChild(v);
    }
    const del=document.createElement('button');
    del.className='del';
    del.innerText='删除';
    del.onclick=async()=>{
      currentData.posts.splice(idx,1);
      await fetch(API,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(currentData)});
      loadManage();
    };
    c.appendChild(del);
    pm.appendChild(c);
  });
}
</script>
</body>
</html>
