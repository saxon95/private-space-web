<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸ªäººä¸»é¡µ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}
body{background:#f5f7fa;padding-bottom:60px}
img{pointer-events:none;-webkit-user-drag:none}

#blocked{position:fixed;inset:0;background:#000;color:#fff;display:grid;place-items:center;font-size:18px;z-index:99999}
#loading{position:fixed;inset:0;background:#fff;display:grid;place-items:center;z-index:9999}
.loader{width:45px;height:45px;border:4px solid #eee;border-top:4px solid #4e8cff;border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}

#register{position:fixed;inset:0;background:rgba(0,0,0,.5);display:grid;place-items:center;z-index:999}
.register-card{background:#fff;padding:25px;border-radius:20px;width:90%;max-width:380px}
.register-card h3{margin-bottom:15px;text-align:center}
.register-card input,.register-card select{width:100%;margin:8px 0;padding:12px;border:1px solid #ddd;border-radius:12px}
.register-card button{width:100%;margin-top:10px;padding:12px;background:#4e8cff;color:#fff;border:none;border-radius:12px}

/* ä¸»é¡µå±•ç¤º */
.main{max-width:700px;margin:0 auto;padding:0 15px}
.profile{background:#fff;border-radius:20px;padding:30px 20px;text-align:center;margin-bottom:20px}
.avatar{width:90px;height:90px;border-radius:50%;margin:0 auto 15px}
.name{font-size:22px;font-weight:600;margin-bottom:6px}
.bio{color:#666;margin-bottom:16px}

.stats{display:flex;justify-content:center;gap:26px;margin:20px 0}
.stats .item{text-align:center}
.stats .num{font-size:18px;font-weight:600}
.stats .label{font-size:13px;color:#666}

.btns{display:flex;gap:10px;justify-content:center;margin-bottom:20px}
.btn{padding:10px 16px;border-radius:12px;border:none;background:#4e8cff;color:#fff}

/* ä¸»é¡µå±•ç¤ºå‘å¸ƒ */
.publish{background:#fff;border-radius:16px;padding:15px;margin-bottom:20px}
.publish input,.publish textarea{width:100%;margin-bottom:10px;padding:12px;border:1px solid #ddd;border-radius:12px}
.publish button{width:100%;padding:12px;background:#4e8cff;color:#fff;border:none;border-radius:12px}

/* åŠ¨æ€å±•ç¤º */
.feed{display:grid;gap:15px}
.card{background:#fff;border-radius:16px;overflow:hidden}
.card img,.card video{width:100%;max-height:400px;object-fit:cover}
.card .content{padding:15px}
.card .title{font-weight:600;margin-bottom:5px}
.card .time{font-size:12px;color:#999}

/* ç”³è¯·è®¿é—® */
.access{background:#fff;border-radius:16px;padding:20px;text-align:center;margin-bottom:20px}
.access-btn{padding:14px 20px;background:#4e8cff;color:#fff;border:none;border-radius:12px;width:100%}

/* èŠå¤©å®¤ */
.chat-room{background:#fff;border-radius:16px;padding:20px}
.chat-room h3{margin-bottom:10px}
#online{text-align:center;font-size:14px;color:#666;margin-bottom:10px}
#chat-messages{max-height:350px;overflow-y:auto;margin-bottom:10px}
.chat-item{padding:10px;background:#f5f7fa;border-radius:10px;margin-bottom:8px}
.chat-info{font-size:12px;color:#666;margin-bottom:4px}
#chat-input{width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;margin-bottom:10px}
#chat-send{width:100%;padding:12px;background:#4e8cff;color:#fff;border:none;border-radius:12px}
.admin-bar{display:flex;gap:8px;margin-top:8px}
.admin-bar button{flex:1;padding:8px;border:none;border-radius:8px}
#admin-clear{background:#ff4444;color:#fff}
#admin-block{background:#ff8800;color:#fff}

#toTop{position:fixed;bottom:20px;right:20px;width:46px;height:46px;background:#4e8cff;color:#fff;border-radius:50%;display:grid;place-items:center}
</style>
</head>

<body>
<div id="loading"><div class="loader"></div></div>

<!-- æ³¨å†Œ -->
<div id="register">
  <div class="register-card">
    <h3>ğŸ‘‹ æ³¨å†Œä¸ªäººä¸»é¡µ</h3>
    <input type="text" id="reg-name" placeholder="æ˜µç§°">
    <input type="number" id="reg-age" placeholder="å¹´é¾„">
    <select id="reg-gender">
      <option value="ç”·">ç”·</option>
      <option value="å¥³">å¥³</option>
      <option value="ä¿å¯†">ä¿å¯†</option>
    </select>
    <button onclick="registerUser()">å®Œæˆæ³¨å†Œ</button>
  </div>
</div>

<div class="main">
  <!-- ä¸ªäººä¿¡æ¯ -->
  <div class="profile">
    < img class="avatar" src="https://picsum.photos/200/200">
    <div class="name">æˆ‘çš„ä¸ªäººä¸»é¡µ</div>
    <div class="bio">åˆ†äº«ç”Ÿæ´»ä¸ç¬é—´</div>

    <div class="stats">
      <div class="item"><div class="num">0</div><div class="label">è®¿é—®</div></div>
      <div class="item"><div class="num">0</div><div class="label">ç‚¹èµ</div></div>
      <div class="item"><div class="num">0</div><div class="label">å±•ç¤º</div></div>
    </div>

    <div class="btns">
      <button class="btn" onclick="copyLink()">å¤åˆ¶é“¾æ¥</button>
      <button class="btn" onclick="likeMe()">ç‚¹èµä¸»é¡µ</button>
    </div>
  </div>

  <!-- ä¸»é¡µå±•ç¤ºå‘å¸ƒ -->
  <div class="publish">
    <h3>ğŸ“ ä¸»é¡µå±•ç¤º</h3>
    <input type="text" id="post-title" placeholder="æ ‡é¢˜">
    <textarea id="post-content" rows="3" placeholder="æ–‡å­—å†…å®¹"></textarea>
    <input type="text" id="post-img" placeholder="å›¾ç‰‡é“¾æ¥">
    <input type="text" id="post-video" placeholder="è§†é¢‘é“¾æ¥">
    <button onclick="publishPost()">å‘å¸ƒåˆ°ä¸»é¡µ</button>
  </div>

  <!-- ç”³è¯·è®¿é—® -->
  <div class="access">
    <h3>ğŸ” ç”³è¯·æŸ¥çœ‹ä¸»é¡µå†…å®¹</h3>
    <p style="margin:10px 0">é€šè¿‡åå³å¯æŸ¥çœ‹å…¨éƒ¨å±•ç¤º</p >
    <button class="access-btn" onclick="applyAccess()">ç”³è¯·è®¿é—®</button>
  </div>

  <!-- é¦–é¡µå±•ç¤ºåŠ¨æ€ -->
  <div class="feed" id="feed"></div>

  <!-- èŠå¤©å®¤ -->
  <div class="chat-room">
    <h3>ğŸ’¬ å…¬å…±èŠå¤©å®¤</h3>
    <div id="online">å½“å‰åœ¨çº¿ï¼š-- äºº</div>
    <div id="chat-messages"></div>
    <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯...">
    <button id="chat-send" onclick="sendChat()">å‘é€</button>
    <div class="admin-bar">
      <button id="admin-clear" onclick="adminClearChat()">ğŸ§¹ æ¸…ç©ºèŠå¤©</button>
      <button id="admin-block" onclick="adminBlock()">ğŸš« æ‹‰é»‘</button>
    </div>
  </div>
</div>

<div id="toTop" onclick="toTop()">â†‘</div>

<script src="https://cdn.jsdelivr.net/npm/waline@3/dist/waline.umd.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/waline@3/dist/waline.css">

<script>
// é˜²æˆªå›¾é˜²ä¿å­˜
document.addEventListener('contextmenu', e=>e.preventDefault());
document.addEventListener('keydown', e=>{
  if(e.key=='PrintScreen'||e.key=='F12'||(e.ctrlKey&&['s','u'].includes(e.key.toLowerCase()))){
    e.preventDefault();alert("ç¦æ­¢æˆªå›¾/ä¿å­˜/æŸ¥çœ‹æºç ");
  }
});

const CHANNEL = "clean-home-2025";
let currentUser = JSON.parse(localStorage.getItem("user")||null);
let myId = Math.random().toString(36).slice(2,10);

// æ£€æŸ¥æ‹‰é»‘
async function checkBlocked(){
  try{
    const r=await fetch(`https://api.npoint.io/room/${CHANNEL}/blocked`);
    const list=await r.json()||[];
    if(list.includes(myId)){
      document.body.innerHTML=`<div style='position:fixed;inset:0;background:#000;color:#fff;display:grid;place-items:center'>ä½ å·²è¢«æ‹‰é»‘<br>æ— æ³•è®¿é—®</div>`;
      throw new Error('blocked');
    }
  }catch(e){}
}

// åŠ è½½
window.addEventListener("load",async ()=>{
  await checkBlocked();
  loading.style.display="none";
  if(currentUser) register.style.display="none";
  loadFeed();
  startOnline();
  loadChat();
});

// æ³¨å†Œ
function registerUser(){
  const name=document.getElementById("reg-name").value.trim();
  const age=document.getElementById("reg-age").value.trim();
  if(!name||!age){alert("è¯·å¡«å†™å®Œæ•´");return;}
  currentUser={name,age,gender:document.getElementById("reg-gender").value};
  localStorage.setItem("user",JSON.stringify(currentUser));
  register.style.display="none";
  alert("æ³¨å†ŒæˆåŠŸ");
}

// å‘å¸ƒä¸»é¡µå±•ç¤º
function publishPost(){
  if(!currentUser){alert("è¯·å…ˆæ³¨å†Œ");return;}
  const title=document.getElementById("post-title").value.trim();
  const content=document.getElementById("post-content").value.trim();
  const img=document.getElementById("post-img").value.trim();
  const video=document.getElementById("post-video").value.trim();
  if(!title&&!content&&!img&&!video){alert("è¯·å¡«å†™å†…å®¹");return;}

  const post={title,content,img,video,user:currentUser,time:new Date().toLocaleString()};
  let list=JSON.parse(localStorage.getItem("posts")||"[]");
  list.unshift(post);
  localStorage.setItem("posts",JSON.stringify(list));
  loadFeed();

  document.getElementById("post-title").value="";
  document.getElementById("post-content").value="";
  document.getElementById("post-img").value="";
  document.getElementById("post-video").value="";
  alert("å‘å¸ƒæˆåŠŸï¼å·²å±•ç¤ºåœ¨é¦–é¡µ");
}

// åŠ è½½ä¸»é¡µå±•ç¤º
function loadFeed(){
  const list=JSON.parse(localStorage.getItem("posts")||"[]");
  const allowed=localStorage.getItem("allowed");
  if(!allowed){
    document.getElementById("feed").innerHTML="<div style='text-align:center;padding:20px'>è¯·ç”³è¯·è®¿é—®æŸ¥çœ‹å†…å®¹</div>";
    return;
  }

  document.getElementById("feed").innerHTML=list.map((p,i)=>`
    <div class="card">
      ${p.img?`< img src="${p.img}">`:""}
      ${p.video?`<video src="${p.video}" controls></video>`:""}
      <div class="content">
        <div class="title">${p.title||"æ— æ ‡é¢˜"}</div>
        <div style="margin:5px 0;white-space:pre-line">${p.content||""}</div>
        <div class="time">${p.time} Â· ${p.user.name}</div>
      </div>
    </div>
  `).join("");
}

// ç”³è¯·è®¿é—®
function applyAccess(){
  if(!currentUser){alert("è¯·å…ˆæ³¨å†Œ");return;}
  alert("ç”³è¯·å·²æäº¤ï¼Œè¯·ç­‰å¾…ä¸»äººåŒæ„");
}

// ç®¡ç†å‘˜è§£é”
function adminAllow(){
  localStorage.setItem("allowed","ok");
  loadFeed();
  alert("å·²å…è®¸è®¿é—®");
}

// åœ¨çº¿ã€èŠå¤©ã€æ‹‰é»‘ã€æ¸…ç©º
function startOnline(){setInterval(()=>{fetch("https://api.npoint.io/online",{method:"POST",body:JSON.stringify({channel:CHANNEL,id:myId})})},5000)}
async function loadChat(){setInterval(async()=>{const r=await fetch(`https://api.npoint.io/room/${CHANNEL}`);const d=await r.json()||{};document.getElementById("online").innerText=`åœ¨çº¿ï¼š${d.online||0} äºº`;document.getElementById("chat-messages").innerHTML=(d.messages||[]).map(m=>`<div class="chat-item"><div class="chat-info">${m.user.name} Â· ${m.user.age}å²</div><div>${m.text}</div></div>`).join("")},2000)}
async function sendChat(){if(!currentUser){alert("è¯·æ³¨å†Œ");return;}const t=document.getElementById("chat-input").value.trim();if(!t)return;await fetch("https://api.npoint.io/send",{method:"POST",body:JSON.stringify({channel:CHANNEL,user:currentUser,text:t})});document.getElementById("chat-input").value=""}
async function adminClearChat(){if(!confirm("ç¡®å®šæ¸…ç©ºï¼Ÿ"))return;await fetch("https://api.npoint.io/clear",{method:"POST",body:JSON.stringify({channel:CHANNEL})});alert("å·²æ¸…ç©º")}
async function adminBlock(){if(!confirm("ç¡®å®šæ‹‰é»‘ï¼Ÿ"))return;await fetch("https://api.npoint.io/block",{method:"POST",body:JSON.stringify({channel:CHANNEL,id:myId})});alert("å·²æ‹‰é»‘")}

// å·¥å…·
async function copyLink(){await navigator.clipboard.writeText(location.href);alert("å·²å¤åˆ¶")}
function likeMe(){Waline.like(window.location.pathname);alert("ç‚¹èµæˆåŠŸâ¤ï¸")}
function toTop(){window.scrollTo({top:0,behavior:'smooth'})}
</script>
</body>
</html>
