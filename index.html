<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§å¯†äº‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #f2f2f7;
            padding-bottom: 80px;
        }
        .hide { display: none !important; }

        /* åŠ è½½ */
        #loading {
            position: fixed;
            inset: 0;
            background: #fff;
            z-index: 9999;
            display: grid;
            place-items: center;
        }
        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e5ea;
            border-top: 4px solid #007aff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: grid;
            place-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 20px;
            width: 90%;
            max-width: 350px;
            text-align: center;
        }
        .modal-content h2 { margin-bottom: 16px; }
        .modal-content p { color: #666; margin-bottom: 16px; }
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d1d6;
            border-radius: 10px;
            margin-bottom: 12px;
            font-size: 16px;
        }
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-primary { background: #007aff; color: #fff; }
        .btn-secondary { background: #e5e5ea; margin-top: 8px; }
        .btn-danger { background: #ff3b30; color: #fff; margin-top: 8px; }

        /* åº•éƒ¨å¯¼èˆª */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            border-top: 1px solid #d1d1d6;
            display: flex;
            padding: 8px 0;
        }
        .tab-item {
            flex: 1;
            text-align: center;
            font-size: 12px;
            color: #8e8e93;
        }
        .tab-item.active { color: #007aff; }
        .tab-item i {
            display: block;
            font-size: 22px;
            margin-bottom: 4px;
        }

        /* é¡µé¢ */
        .page { padding: 16px; display: none; }
        .page.active { display: block; }

        .card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        /* ä¸ªäººç§€ */
        .profile-header { text-align: center; padding: 24px; }
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 16px;
            cursor: pointer;
        }
        .name { font-size: 24px; font-weight: 700; }
        .bio { color: #8e8e93; margin-top: 4px; }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f2f2f7;
        }
        .info-label { color: #8e8e93; }
        .size-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 8px;
        }

        /* é£æ ¼æ ‡ç­¾ */
        .style-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .style-tag {
            background: #e5e5ea;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
        }

        /* ç§å¯†ç©ºé—´ */
        .private-space h3 {
            margin-bottom: 12px;
            color: #ff3b30;
        }
        .countdown {
            color: #007aff;
            font-size: 12px;
            margin: 6px 0;
        }

        /* ç§å¯†äº‘ç©ºçŠ¶æ€ */
        .empty {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
    </style>
</head>
<body>

<div id="loading"><div class="loader"></div></div>

<!-- å¹´é¾„éªŒè¯ -->
<div id="ageModal" class="modal">
    <div class="modal-content">
        <h2>å¹´é¾„éªŒè¯</h2>
        <p>ä»…é™18å²ä»¥ä¸Šè®¿é—®</p>
        <input type="number" id="birthYear" placeholder="è¾“å…¥å‡ºç”Ÿå¹´ä»½">
        <button class="btn btn-primary" onclick="verifyAge()">ç¡®è®¤è¿›å…¥</button>
        <button class="btn btn-secondary" onclick="document.body.innerHTML='è®¿é—®å·²æ‹’ç»'">é€€å‡º</button>
    </div>
</div>

<!-- å‘å¸ƒæ™®é€šåŠ¨æ€ -->
<div id="postModal" class="modal hide">
    <div class="modal-content">
        <h2>å‘å¸ƒåŠ¨æ€</h2>
        <textarea id="postText" placeholder="åˆ†äº«..."></textarea>
        <input type="file" id="postMedia" accept="image/*,video/*">
        <button class="btn btn-primary" onclick="publishPost()">å‘å¸ƒ</button>
        <button class="btn btn-secondary" onclick="closeModal('postModal')">å–æ¶ˆ</button>
    </div>
</div>

<!-- ç¼–è¾‘ä¸ªäººèµ„æ–™ â†’ å°ºå¯¸å¯ä¸Šä¼ å›¾ç‰‡ + è¶…å¤šé£æ ¼ -->
<div id="editProfileModal" class="modal hide">
    <div class="modal-content">
        <h2>ç¼–è¾‘èµ„æ–™</h2>
        <input type="text" id="editName" placeholder="æ˜µç§°">
        <input type="number" id="editHeight" placeholder="èº«é«˜ cm">
        <input type="number" id="editWeight" placeholder="ä½“é‡ kg">
        <input type="text" id="editSize" placeholder="å°ºå¯¸ cm/A-E">
        <input type="file" id="editSizeImg" accept="image/*">
        <small style="color:#666">å°ºå¯¸å›¾ç‰‡</small>

        <select id="editStyle" multiple size="9">
            <option>å¯çˆ±</option>
            <option>å‘†èŒ</option>
            <option>é«˜å†·</option>
            <option>èè‰</option>
            <option>å¾¡å§</option>
            <option>ç½‘ç˜¾å°‘å¹´</option>
            <option>æ€§æ„Ÿ</option>
            <option>çº¯æ¬²</option>
            <option>è¯±æƒ‘</option>
        </select>
        <small>å¯å¤šé€‰é£æ ¼</small>

        <input type="file" id="editAvatar" accept="image/*" style="margin-top:12px">
        <button class="btn btn-primary" onclick="saveProfile()">ä¿å­˜</button>
        <button class="btn btn-secondary" onclick="closeModal('editProfileModal')">å–æ¶ˆ</button>
    </div>
</div>

<!-- å‘å¸ƒç§å¯†é™æ—¶å†…å®¹ -->
<div id="privateModal" class="modal hide">
    <div class="modal-content">
        <h2>ç§å¯†å‘å¸ƒ</h2>
        <input type="file" id="privateFile" accept="image/*,video/*">
        <select id="privateHour">
            <option value="3600000">1å°æ—¶</option>
            <option value="86400000">24å°æ—¶</option>
        </select>
        <button class="btn btn-primary" onclick="addPrivate()">å‘å¸ƒ</button>
        <button class="btn btn-secondary" onclick="closeModal('privateModal')">å–æ¶ˆ</button>
    </div>
</div>

<!-- ä¸»ç•Œé¢ -->
<div id="app" class="hide">
    <!-- é¦–é¡µ -->
    <div id="home" class="page active">
        <button class="btn btn-primary" onclick="openModal('postModal')">+ å‘å¸ƒåŠ¨æ€</button>
        <div id="postList" style="margin-top:16px"></div>
    </div>

    <!-- ä¸ªäººç§€ -->
    <div id="profilePage" class="page">
        <div class="card profile-header">
            <img class="avatar" id="avatarShow" onclick="openModal('editProfileModal')">
            <div class="name" id="nameShow"></div>
            <div class="bio" id="styleShow"></div>
            <div class="style-tags" id="tagList"></div>
        </div>

        <div class="card">
            <div class="info-row">
                <span class="info-label">èº«é«˜</span>
                <span id="heightShow">--</span>
            </div>
            <div class="info-row">
                <span class="info-label">ä½“é‡</span>
                <span id="weightShow">--</span>
            </div>
            <div class="info-row">
                <span class="info-label">å°ºå¯¸</span>
                <span id="sizeShow">--</span>
            </div>
            <img id="sizeImgShow" class="size-img hide">
        </div>

        <!-- ç§å¯†ç©ºé—´ -->
        <div class="card private-space">
            <h3>ğŸ”’ ç§å¯†ç©ºé—´</h3>
            <button class="btn btn-primary" onclick="openModal('privateModal')">å‘å¸ƒé™æ—¶ç…§ç‰‡/è§†é¢‘</button>
            <div id="privateList" style="margin-top:16px"></div>
        </div>

        <button class="btn btn-primary" onclick="openModal('editProfileModal')">ç¼–è¾‘èµ„æ–™</button>
    </div>

    <!-- ç§å¯†äº‘ -->
    <div id="privateCloud" class="page">
        <div class="empty">
            <div style="font-size:40px">ğŸ”’</div>
            <div style="margin-top:16px">ç§å¯†äº‘</div>
        </div>
    </div>

    <!-- åº•éƒ¨æ  -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="go('home')"><i>ğŸ </i><span>é¦–é¡µ</span></div>
        <div class="tab-item" onclick="go('profilePage')"><i>âœ¨</i><span>ä¸ªäººç§€</span></div>
        <div class="tab-item" onclick="go('privateCloud')"><i>â˜ï¸</i><span>ç§å¯†äº‘</span></div>
    </div>
</div>

<script>
// æ•°æ®
let user = JSON.parse(localStorage.getItem('user')) || {
    name: 'ç”¨æˆ·',
    height: '', weight: '', size: '',
    avatar: '', sizeImg: '', style: []
}
let posts = JSON.parse(localStorage.getItem('posts')) || []
let privateList = JSON.parse(localStorage.getItem('private')) || []

// åŠ è½½
window.onload = () => {
    setTimeout(()=>loading.classList.add('hide'),500)
    if(localStorage.getItem('age')){
        ageModal.classList.add('hide')
        app.classList.remove('hide')
        refreshAll()
    }
}

// å¹´é¾„éªŒè¯
function verifyAge(){
    let y = +birthYear.value
    if(!y || new Date().getFullYear()-y <18) return alert('æœªæ»¡18å²ç¦æ­¢è®¿é—®')
    localStorage.setItem('age',1)
    ageModal.classList.add('hide')
    app.classList.remove('hide')
    refreshAll()
}

// é¡µé¢åˆ‡æ¢
function go(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'))
    document.querySelectorAll('.tab-item').forEach(t=>t.classList.remove('active'))
    document.getElementById(id).classList.add('active')
    event.currentTarget.classList.add('active')
}

function openModal(m){ document.getElementById(m).classList.remove('hide') }
function closeModal(m){ document.getElementById(m).classList.add('hide') }

// å‘å¸ƒæ™®é€šåŠ¨æ€
function publishPost(){
    let txt = postText.value
    let file = postMedia.files[0]
    if(!txt && !file) return alert('è¯·è¾“å…¥å†…å®¹æˆ–é€‰æ‹©æ–‡ä»¶')
    let url = file ? URL.createObjectURL(file) : ''
    let type = file?.type.startsWith('image') ? 'img' : file?.type.startsWith('video') ? 'vid' : ''
    posts.unshift({id:Date.now(),txt,url,type})
    localStorage.setItem('posts',JSON.stringify(posts))
    refreshPosts()
    closeModal('postModal')
    postText.value=''
    postMedia.value=''
}

// æ¸²æŸ“åŠ¨æ€
function refreshPosts(){
    postList.innerHTML = ''
    posts.forEach(p=>{
        let d = document.createElement('div')
        d.className='card'
        d.innerHTML = `
            <div>${p.txt}</div>
            ${p.type=='img'?`<img src="${p.url}" style="width:100%;border-radius:10px;margin-top:8px">`:''}
            ${p.type=='vid'?`<video src="${p.url}" controls style="width:100%;margin-top:8px"></video>`:''}
            <div style="text-align:right;margin-top:8px">
                <button onclick="delPost(${p.id})" style="color:red;border:none;background:none">åˆ é™¤</button>
            </div>
        `
        postList.appendChild(d)
    })
}
function delPost(id){
    posts = posts.filter(x=>x.id!=id)
    localStorage.setItem('posts',JSON.stringify(posts))
    refreshPosts()
}

// ä¿å­˜èµ„æ–™ï¼ˆå°ºå¯¸å›¾ç‰‡ + å¤šé£æ ¼ï¼‰
function saveProfile(){
    user.name = editName.value || user.name
    user.height = editHeight.value
    user.weight = editWeight.value
    user.size = editSize.value

    let ava = editAvatar.files[0]
    if(ava) user.avatar = URL.createObjectURL(ava)

    let simg = editSizeImg.files[0]
    if(simg) user.sizeImg = URL.createObjectURL(simg)

    let s = []
    for(let opt of editStyle.selectedOptions) s.push(opt.value)
    user.style = s

    localStorage.setItem('user',JSON.stringify(user))
    refreshProfile()
    closeModal('editProfileModal')
}

// æ¸²æŸ“ä¸ªäººç§€
function refreshProfile(){
    nameShow.innerText = user.name
    avatarShow.src = user.avatar || 'https://picsum.photos/200/200'
    heightShow.innerText = user.height || '--'
    weightShow.innerText = user.weight || '--'
    sizeShow.innerText = user.size || '--'

    if(user.sizeImg){
        sizeImgShow.src = user.sizeImg
        sizeImgShow.classList.remove('hide')
    } else sizeImgShow.classList.add('hide')

    styleShow.innerText = user.style.join(' ') || 'ç‚¹å‡»ç¼–è¾‘é£æ ¼'
    tagList.innerHTML = ''
    user.style.forEach(t=>{
        let span = document.createElement('span')
        span.className='style-tag'
        span.innerText = t
        tagList.appendChild(span)
    })
}

// ç§å¯†é™æ—¶å‘å¸ƒ
function addPrivate(){
    let f = privateFile.files[0]
    if(!f) return alert('è¯·é€‰æ‹©å›¾ç‰‡æˆ–è§†é¢‘')
    let t = privateHour.value
    let now = Date.now()
    privateList.unshift({
        id:now, url:URL.createObjectURL(f),
        type:f.type.startsWith('image')?'img':'vid',
        exp:now + +t
    })
    localStorage.setItem('private',JSON.stringify(privateList))
    refreshPrivate()
    closeModal('privateModal')
    privateFile.value=''
}

// åˆ·æ–°ç§å¯†ç©ºé—´
function refreshPrivate(){
    privateList = privateList.filter(p=>p.exp > Date.now())
    localStorage.setItem('private',JSON.stringify(privateList))
    privateList.innerHTML = ''
    privateList.forEach(p=>{
        let d = document.createElement('div')
        d.className='card'
        let left = p.exp - Date.now()
        let h = Math.floor(left/3600000)
        let m = Math.floor((left%3600000)/60000)
        d.innerHTML = `
            ${p.type=='img'?`<img src="${p.url}" style="width:100%;border-radius:10px">`:''}
            ${p.type=='vid'?`<video src="${p.url}" controls style="width:100%"></video>`:''}
            <div class="countdown">å‰©ä½™ ${h}æ—¶${m}åˆ†</div>
            <button class="btn btn-danger" onclick="delPrivate(${p.id})">ç«‹å³åˆ é™¤</button>
        `
        privateList.appendChild(d)
    })
}
function delPrivate(id){
    privateList = privateList.filter(p=>p.id!=id)
    localStorage.setItem('private',JSON.stringify(privateList))
    refreshPrivate()
}

function refreshAll(){
    refreshProfile()
    refreshPosts()
    refreshPrivate()
}
</script>
</body>
</html>
