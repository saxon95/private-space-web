<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§å¯†äº‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        body {
            background: #f2f2f7;
            padding-bottom: 80px;
        }

        .hide {
            display: none !important;
        }

        /* åŠ è½½åŠ¨ç”» */
        #loading {
            position: fixed;
            inset: 0;
            background: #fff;
            z-index: 9999;
            display: grid;
            place-items: center;
        }
        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e5ea;
            border-top: 4px solid #007aff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: grid;
            place-items: center;
        }
        .modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 20px;
            width: 90%;
            max-width: 350px;
            text-align: center;
        }
        .modal-content h2 {
            margin-bottom: 16px;
            color: #000;
        }
        .modal-content p {
            color: #666;
            margin-bottom: 20px;
        }
        .modal-content input,
        .modal-content textarea,
        .modal-content select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d1d6;
            border-radius: 10px;
            margin-bottom: 16px;
            font-size: 16px;
        }
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-primary {
            background: #007aff;
            color: #fff;
        }
        .btn-secondary {
            background: #e5e5ea;
            color: #000;
            margin-top: 8px;
        }
        .btn-danger {
            background: #ff3b30;
            color: #fff;
            margin-top: 8px;
        }

        /* åº•éƒ¨å¯¼èˆªæ  */
        .tab-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #fff;
            border-top: 1px solid #d1d1d6;
            display: flex;
            padding: 8px 0;
        }
        .tab-item {
            flex: 1;
            text-align: center;
            font-size: 12px;
            color: #8e8e93;
            cursor: pointer;
        }
        .tab-item.active {
            color: #007aff;
        }
        .tab-item i {
            display: block;
            font-size: 24px;
            margin-bottom: 4px;
        }

        /* é¡µé¢ */
        .page {
            padding: 16px;
            display: none;
        }
        .page.active {
            display: block;
        }

        /* å¡ç‰‡ */
        .card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* åŠ¨æ€åˆ—è¡¨ */
        .post {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
        }
        .post-author {
            font-weight: 600;
        }
        .post-time {
            color: #8e8e93;
            font-size: 12px;
        }
        .post-content {
            margin-bottom: 12px;
        }
        .post-image, .post-video {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .post-actions {
            display: flex;
            gap: 16px;
            margin-top: 12px;
        }
        .post-action {
            color: #8e8e93;
            cursor: pointer;
        }
        .post-action.active {
            color: #ff3b30;
        }

        /* ä¸ªäººç§€ */
        .profile-header {
            text-align: center;
            padding: 24px;
        }
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 16px;
            cursor: pointer;
        }
        .name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .bio {
            color: #8e8e93;
            font-size: 16px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f2f2f7;
        }
        .info-label {
            color: #8e8e93;
        }
        .info-value {
            font-weight: 500;
        }
        .style-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .style-tag {
            background: #e5e5ea;
            color: #000;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
        }

        /* ç§å¯†ç©ºé—´ */
        .private-space {
            margin-top: 16px;
        }
        .private-space h3 {
            margin-bottom: 12px;
            color: #ff3b30;
        }
        .expired {
            color: #ff3b30;
            font-size: 12px;
            margin-top: 4px;
        }
        .countdown {
            color: #007aff;
            font-size: 12px;
            margin-top: 4px;
        }

        /* ç§å¯†äº‘ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8e8e93;
        }
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            display: block;
        }
    </style>
</head>
<body>

<div id="loading"><div class="loader"></div></div>

<!-- å¹´é¾„éªŒè¯ -->
<div id="ageModal" class="modal">
    <div class="modal-content">
        <h2>å¹´é¾„éªŒè¯</h2>
        <p>æœ¬å†…å®¹ä»…é™18å²ä»¥ä¸Šç”¨æˆ·è®¿é—®</p>
        <input type="number" id="birthYear" placeholder="è¯·è¾“å…¥æ‚¨çš„å‡ºç”Ÿå¹´ä»½">
        <button class="btn btn-primary" onclick="verifyAge()">ç¡®è®¤è¿›å…¥</button>
        <button class="btn btn-secondary" onclick="document.body.innerHTML='<h1>è®¿é—®å·²æ‹’ç»</h1>'">æœªæ»¡18å²</button>
    </div>
</div>

<!-- å‘å¸ƒåŠ¨æ€æ¨¡æ€æ¡† -->
<div id="postModal" class="modal hide">
    <div class="modal-content">
        <h2>å‘å¸ƒåŠ¨æ€</h2>
        <textarea id="postText" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..."></textarea>
        <input type="file" id="postMedia" accept="image/*,video/*">
        <button class="btn btn-primary" onclick="publishPost()">å‘å¸ƒ</button>
        <button class="btn btn-secondary" onclick="closeModal('postModal')">å–æ¶ˆ</button>
    </div>
</div>

<!-- ç¼–è¾‘ä¸ªäººèµ„æ–™æ¨¡æ€æ¡† -->
<div id="editProfileModal" class="modal hide">
    <div class="modal-content">
        <h2>ç¼–è¾‘èµ„æ–™</h2>
        <input type="text" id="editName" placeholder="æ˜µç§°">
        <input type="number" id="editHeight" placeholder="èº«é«˜ (cm)">
        <input type="number" id="editWeight" placeholder="ä½“é‡ (kg)">
        <input type="text" id="editSize" placeholder="å°ºå¯¸ (cm/A-E)">
        <input type="text" id="editStyle" placeholder="é£æ ¼ï¼ˆå¦‚ï¼šæ€§æ„Ÿã€çº¯æ¬²ï¼‰">
        <input type="file" id="editAvatar" accept="image/*">
        <button class="btn btn-primary" onclick="saveProfile()">ä¿å­˜</button>
        <button class="btn btn-secondary" onclick="closeModal('editProfileModal')">å–æ¶ˆ</button>
    </div>
</div>

<!-- å‘å¸ƒç§å¯†å†…å®¹æ¨¡æ€æ¡† -->
<div id="privatePostModal" class="modal hide">
    <div class="modal-content">
        <h2>å‘å¸ƒç§å¯†å†…å®¹</h2>
        <p>å†…å®¹å°†åœ¨é™æ—¶ç»“æŸåè‡ªåŠ¨åˆ é™¤</p>
        <input type="file" id="privateMedia" accept="image/*,video/*">
        <select id="privateDuration">
            <option value="3600000">1å°æ—¶</option>
            <option value="7200000">2å°æ—¶</option>
            <option value="14400000">4å°æ—¶</option>
            <option value="28800000">8å°æ—¶</option>
            <option value="86400000">24å°æ—¶</option>
        </select>
        <button class="btn btn-primary" onclick="publishPrivatePost()">å‘å¸ƒ</button>
        <button class="btn btn-secondary" onclick="closeModal('privatePostModal')">å–æ¶ˆ</button>
    </div>
</div>

<!-- ä¸»å†…å®¹ -->
<div id="app" class="hide">
    <!-- 1. é¦–é¡µ -->
    <div id="home" class="page active">
        <button class="btn btn-primary" style="margin-bottom: 16px;" onclick="openModal('postModal')">+ å‘å¸ƒåŠ¨æ€</button>
        <div id="postList">
            <!-- åŠ¨æ€åˆ—è¡¨å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- 2. ä¸ªäººç§€ -->
    <div id="showcase" class="page">
        <div class="card profile-header">
            <img class="avatar" id="avatar" src="https://picsum.photos/200/200?1" alt="Avatar" onclick="openModal('editProfileModal')">
            <div class="name" id="profileName">ç”¨æˆ·</div>
            <div class="bio" id="profileBio">ç‚¹å‡»å¤´åƒç¼–è¾‘èµ„æ–™</div>
            <div class="style-tags" id="styleTags"></div>
        </div>

        <div class="card">
            <div class="info-row">
                <span class="info-label">èº«é«˜</span>
                <span class="info-value" id="profileHeight">--</span>
            </div>
            <div class="info-row">
                <span class="info-label">ä½“é‡</span>
                <span class="info-value" id="profileWeight">--</span>
            </div>
            <div class="info-row">
                <span class="info-label">å°ºå¯¸</span>
                <span class="info-value" id="profileSize">--</span>
            </div>
        </div>

        <!-- æ–°å¢ï¼šç§å¯†ç©ºé—´ -->
        <div class="card private-space">
            <h3>ğŸ”’ ç§å¯†ç©ºé—´</h3>
            <button class="btn btn-primary" style="margin-bottom: 16px;" onclick="openModal('privatePostModal')">+ å‘å¸ƒé™æ—¶å†…å®¹</button>
            <div id="privatePostList">
                <!-- ç§å¯†å†…å®¹åˆ—è¡¨å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <button class="btn btn-primary" onclick="openModal('editProfileModal')">ç¼–è¾‘èµ„æ–™</button>
    </div>

    <!-- 3. ç§å¯†äº‘ -->
    <div id="private-cloud" class="page">
        <div class="empty-state">
            <i>ğŸ”’</i>
            <h3>ç§å¯†äº‘</h3>
            <p>è¿™é‡Œæ˜¯ä½ çš„ä¸“å±ç©ºé—´ï¼Œæ¶ˆæ¯å’Œäº’åŠ¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
        </div>
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="switchPage('home')">
            <i>ğŸ </i>
            <span>é¦–é¡µ</span>
        </div>
        <div class="tab-item" onclick="switchPage('showcase')">
            <i>âœ¨</i>
            <span>ä¸ªäººç§€</span>
        </div>
        <div class="tab-item" onclick="switchPage('private-cloud')">
            <i>â˜ï¸</i>
            <span>ç§å¯†äº‘</span>
        </div>
    </div>
</div>

<script>
    // æ•°æ®å­˜å‚¨
    let userData = JSON.parse(localStorage.getItem('userData')) || {
        name: 'ç”¨æˆ·',
        height: '',
        weight: '',
        size: '',
        style: '',
        avatar: 'https://picsum.photos/200/200?1'
    };

    let posts = JSON.parse(localStorage.getItem('posts')) || [
        {
            id: 1,
            author: 'ç”¨æˆ·',
            avatar: 'https://picsum.photos/200/200?1',
            time: 'åˆšåˆš',
            content: 'æ¬¢è¿æ¥åˆ°ç§å¯†äº‘ï¼',
            media: 'https://picsum.photos/400/200?1',
            type: 'image',
            likes: 0
        }
    ];

    let privatePosts = JSON.parse(localStorage.getItem('privatePosts')) || [];

    // é¡µé¢åŠ è½½
    window.onload = () => {
        setTimeout(() => document.getElementById('loading').classList.add('hide'), 500);
        if (localStorage.getItem('ageVerified')) {
            document.getElementById('ageModal').classList.add('hide');
            document.getElementById('app').classList.remove('hide');
            renderPosts();
            renderProfile();
            renderPrivatePosts(); // æ¸²æŸ“ç§å¯†å†…å®¹
        }
    };

    // å¹´é¾„éªŒè¯
    function verifyAge() {
        const year = document.getElementById('birthYear').value;
        if (!year || year.length < 4) {
            alert('è¯·è¾“å…¥æ­£ç¡®çš„å‡ºç”Ÿå¹´ä»½');
            return;
        }
        const age = new Date().getFullYear() - parseInt(year);
        if (age >= 18) {
            localStorage.setItem('ageVerified', 'true');
            document.getElementById('ageModal').classList.add('hide');
            document.getElementById('app').classList.remove('hide');
            renderPosts();
            renderProfile();
            renderPrivatePosts();
        } else {
            alert('æœªæ»¡18å²ï¼Œç¦æ­¢è®¿é—®');
        }
    }

    // é¡µé¢åˆ‡æ¢
    function switchPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // æ¨¡æ€æ¡†æ“ä½œ
    function openModal(modalId) {
        document.getElementById(modalId).classList.remove('hide');
    }
    function closeModal(modalId) {
        document.getElementById(modalId).classList.add('hide');
    }

    // å‘å¸ƒåŠ¨æ€
    function publishPost() {
        const text = document.getElementById('postText').value;
        const mediaFile = document.getElementById('postMedia').files[0];
        if (!text && !mediaFile) {
            alert('è¯·è¾“å…¥å†…å®¹æˆ–é€‰æ‹©åª’ä½“æ–‡ä»¶');
            return;
        }

        let mediaUrl = '';
        let mediaType = '';
        if (mediaFile) {
            mediaUrl = URL.createObjectURL(mediaFile);
            mediaType = mediaFile.type.startsWith('image/') ? 'image' : 'video';
        }

        const newPost = {
            id: Date.now(),
            author: userData.name,
            avatar: userData.avatar,
            time: 'åˆšåˆš',
            content: text,
            media: mediaUrl,
            type: mediaType,
            likes: 0
        };

        posts.unshift(newPost);
        localStorage.setItem('posts', JSON.stringify(posts));
        renderPosts();
        closeModal('postModal');
    }

    // æ¸²æŸ“åŠ¨æ€åˆ—è¡¨
    function renderPosts() {
        const postList = document.getElementById('postList');
        postList.innerHTML = '';
        posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.className = 'post';
            postElement.id = `post-${post.id}`;
            postElement.innerHTML = `
                <div class="post-header">
                    <img class="post-avatar" src="${post.avatar}" alt="Avatar">
                    <div>
                        <div class="post-author">${post.author}</div>
                        <div class="post-time">${post.time}</div>
                    </div>
                </div>
                <div class="post-content">${post.content}</div>
                ${post.type === 'image' ? `<img class="post-image" src="${post.media}" alt="Post image">` : ''}
                ${post.type === 'video' ? `<video class="post-video" src="${post.media}" controls></video>` : ''}
                <div class="post-actions">
                    <span class="post-action ${post.likes > 0 ? 'active' : ''}" onclick="likePost(${post.id})">â¤ï¸ ${post.likes}</span>
                    <span class="post-action" onclick="commentPost(${post.id})">ğŸ’¬ è¯„è®º</span>
                    <span class="post-action" onclick="deletePost(${post.id})">ğŸ—‘ï¸ åˆ é™¤</span>
                </div>
            `;
            postList.appendChild(postElement);
        });
    }

    // ç‚¹èµåŠ¨æ€
    function likePost(postId) {
        const post = posts.find(p => p.id === postId);
        if (post) {
            post.likes++;
            localStorage.setItem('posts', JSON.stringify(posts));
            renderPosts();
        }
    }

    // è¯„è®ºåŠ¨æ€
    function commentPost(postId) {
        alert('è¯„è®ºåŠŸèƒ½å¼€å‘ä¸­...');
    }

    // åˆ é™¤åŠ¨æ€
    function deletePost(postId) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡åŠ¨æ€å—ï¼Ÿ')) {
            posts = posts.filter(p => p.id !== postId);
            localStorage.setItem('posts', JSON.stringify(posts));
            renderPosts();
        }
    }

    // æ¸²æŸ“ä¸ªäººèµ„æ–™
    function renderProfile() {
        document.getElementById('avatar').src = userData.avatar;
        document.getElementById('profileName').innerText = userData.name;
        document.getElementById('profileHeight').innerText = userData.height || '--';
        document.getElementById('profileWeight').innerText = userData.weight || '--';
        document.getElementById('profileSize').innerText = userData.size || '--';
        document.getElementById('profileBio').innerText = userData.style || 'ç‚¹å‡»å¤´åƒç¼–è¾‘èµ„æ–™';

        const styleTags = document.getElementById('styleTags');
        styleTags.innerHTML = '';
        if (userData.style) {
            userData.style.split('ã€').forEach(style => {
                const tag = document.createElement('span');
                tag.className = 'style-tag';
                tag.innerText = style;
                styleTags.appendChild(tag);
            });
        }
    }

    // ä¿å­˜ä¸ªäººèµ„æ–™
    function saveProfile() {
        userData.name = document.getElementById('editName').value || userData.name;
        userData.height = document.getElementById('editHeight').value;
        userData.weight = document.getElementById('editWeight').value;
        userData.size = document.getElementById('editSize').value;
        userData.style = document.getElementById('editStyle').value;

        const avatarFile = document.getElementById('editAvatar').files[0];
        if (avatarFile) {
            userData.avatar = URL.createObjectURL(avatarFile);
        }

        localStorage.setItem('userData', JSON.stringify(userData));
        renderProfile();
        renderPosts(); // æ›´æ–°åŠ¨æ€ä¸­çš„å¤´åƒ
        closeModal('editProfileModal');
    }

    // --- æ–°å¢ï¼šç§å¯†ç©ºé—´åŠŸèƒ½ ---
    function publishPrivatePost() {
        const mediaFile = document.getElementById('privateMedia').files[0];
        const duration = parseInt(document.getElementById('privateDuration').value);

        if (!mediaFile) {
            alert('è¯·é€‰æ‹©è¦å‘å¸ƒçš„ç…§ç‰‡æˆ–è§†é¢‘');
            return;
        }

        const mediaUrl = URL.createObjectURL(mediaFile);
        const mediaType = mediaFile.type.startsWith('image/') ? 'image' : 'video';
        const now = Date.now();
        const expireAt = now + duration;

        const newPrivatePost = {
            id: Date.now(),
            media: mediaUrl,
            type: mediaType,
            createdAt: now,
            expireAt: expireAt
        };

        privatePosts.unshift(newPrivatePost);
        localStorage.setItem('privatePosts', JSON.stringify(privatePosts));
        renderPrivatePosts();
        closeModal('privatePostModal');
    }

    function renderPrivatePosts() {
        const list = document.getElementById('privatePostList');
        list.innerHTML = '';
        const now = Date.now();

        // è¿‡æ»¤æ‰å·²è¿‡æœŸçš„å†…å®¹
        privatePosts = privatePosts.filter(p => p.expireAt > now);
        localStorage.setItem('privatePosts', JSON.stringify(privatePosts));

        if (privatePosts.length === 0) {
            list.innerHTML = '<p style="color: #8e8e93; text-align: center;">æš‚æ— ç§å¯†å†…å®¹</p>';
            return;
        }

        privatePosts.forEach(p => {
            const item = document.createElement('div');
            item.className = 'post';
            const remaining = p.expireAt - Date.now();
            const hours = Math.floor(remaining / 3600000);
            const minutes = Math.floor((remaining % 3600000) / 60000);

            item.innerHTML = `
                ${p.type === 'image' ? `<img class="post-image" src="${p.media}">` : ''}
                ${p.type === 'video' ? `<video class="post-video" src="${p.media}" controls></video>` : ''}
                <div class="countdown">å‰©ä½™ ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿåè‡ªåŠ¨åˆ é™¤</div>
                <button class="btn btn-danger" onclick="deletePrivatePost(${p.id})">ç«‹å³åˆ é™¤</button>
            `;
            list.appendChild(item);
        });
    }

    function deletePrivatePost(id) {
        if (confirm('ç¡®å®šè¦ç«‹å³åˆ é™¤è¿™æ¡ç§å¯†å†…å®¹å—ï¼Ÿ')) {
            privatePosts = privatePosts.filter(p => p.id !== id);
            localStorage.setItem('privatePosts', JSON.stringify(privatePosts));
            renderPrivatePosts();
        }
    }
</script>
</body>
</html>
