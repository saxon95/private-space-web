<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå°</title>
    <style>
        :root {
            --bg: #e6f2ff;
            --card: #ffffff;
            --text: #222;
            --sub: #666;
            --accent: #ff8fb7;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Helvetica Neue', sans-serif;
        }
        body {
            background: var(--bg);
            color: var(--text);
            padding: 20px 15px 80px;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: var(--card);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        .tab.active {
            background: var(--accent);
            color: #fff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 14px;
        }
        .btn {
            width: 100%;
            padding: 12px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 6px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #fff;
        }
        .title {
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 10px;
        }
        .message-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        .message-text {
            margin-bottom: 4px;
        }
        .message-time {
            font-size: 12px;
            color: var(--sub);
        }
    </style>
</head>
<body>
<div class="tabs">
    <div class="tab active" onclick="switchTab(0)">åšä¸»èµ„æ–™</div>
    <div class="tab" onclick="switchTab(1)">åŠ¨æ€å‘å¸ƒ</div>
    <div class="tab" onclick="switchTab(2)">æ¶ˆæ¯ä¸­å¿ƒ</div>
</div>

<div class="tab-content active" id="tab0">
    <div class="card">
        <h3 class="title">âš™ï¸ åšä¸»èµ„æ–™</h3>
        å¤´åƒï¼š<input type="file" id="avatarInput" accept="image/*"><br>
        <input placeholder="æ˜µç§°" id="name">
        <input placeholder="èº«é«˜ cm" id="height">
        <input placeholder="å¹´é¾„" id="age">
        <input placeholder="å°ºå¯¸" id="size">
        å°ºå¯¸å›¾ï¼š<input type="file" id="sizeImg" accept="image/*">
        <button class="btn" onclick="saveProfile()">ä¿å­˜èµ„æ–™</button>
    </div>
</div>

<div class="tab-content" id="tab1">
    <div class="card">
        <h3 class="title">ğŸ“ å‘å¸ƒåŠ¨æ€</h3>
        <textarea placeholder="å†™ç‚¹ä»€ä¹ˆ..." id="postTxt" rows="3"></textarea>
        <input type="file" id="postFile" accept="image/*,video/*">
        <button class="btn" onclick="publish()">å‘å¸ƒ</button>
    </div>
    <div class="card">
        <h3 class="title">ğŸ“Œ åŠ¨æ€ç®¡ç†</h3>
        <div id="postsList"></div>
    </div>
</div>

<div class="tab-content" id="tab2">
    <div class="card">
        <h3 class="title">ğŸ’¬ æ¶ˆæ¯ä¸­å¿ƒ</h3>
        <div id="messagesList"></div>
    </div>
</div>

<script>
let user = JSON.parse(localStorage.getItem('user')) || {};
let posts = JSON.parse(localStorage.getItem('posts')) || [];
let messages = JSON.parse(localStorage.getItem('messages')) || [];

function switchTab(index) {
    document.querySelectorAll('.tab').forEach((t, i) => {
        t.classList.toggle('active', i === index);
    });
    document.querySelectorAll('.tab-content').forEach((c, i) => {
        c.classList.toggle('active', i === index);
    });
    if (index === 2) renderMessages();
}

function saveProfile() {
    const newUser = {
        name: document.getElementById('name').value || user.name,
        height: document.getElementById('height').value || user.height,
        age: document.getElementById('age').value || user.age,
        size: document.getElementById('size').value || user.size,
        avatar: user.avatar,
        sizeImg: user.sizeImg
    };
    const avatarFile = document.getElementById('avatarInput').files[0];
    const sizeFile = document.getElementById('sizeImg').files[0];
    let tasks = [];
    if (avatarFile) {
        tasks.push(new Promise(resolve => {
            const r = new FileReader();
            r.onload = e => { newUser.avatar = e.target.result; resolve(); };
            r.readAsDataURL(avatarFile);
        }));
    }
    if (sizeFile) {
        tasks.push(new Promise(resolve => {
            const r = new FileReader();
            r.onload = e => { newUser.sizeImg = e.target.result; resolve(); };
            r.readAsDataURL(sizeFile);
        }));
    }
    Promise.all(tasks).then(() => {
        localStorage.setItem('user', JSON.stringify(newUser));
        alert('ä¿å­˜æˆåŠŸ');
    });
}

function publish() {
    const txt = document.getElementById('postTxt').value;
    const file = document.getElementById('postFile').files[0];
    if (!txt && !file) return alert('è¯·è¾“å…¥å†…å®¹æˆ–é€‰æ‹©æ–‡ä»¶');
    const p = { txt, type: '', url: '', time: Date.now() };
    if (file) {
        const r = new FileReader();
        r.onload = e => {
            p.type = file.type.startsWith('image') ? 'img' : 'vid';
            p.url = e.target.result;
            posts.unshift(p);
            localStorage.setItem('posts', JSON.stringify(posts));
            alert('å‘å¸ƒæˆåŠŸ');
            renderPosts();
        };
        r.readAsDataURL(file);
    } else {
        posts.unshift(p);
        localStorage.setItem('posts', JSON.stringify(posts));
        alert('å‘å¸ƒæˆåŠŸ');
        renderPosts();
    }
}

function renderPosts() {
    let html = '';
    posts.forEach((item, i) => {
        html += `
        <div class="post card">
            ${item.txt || ''}
            ${item.type === 'img' ? `< img src="${item.url}">` : ''}
            ${item.type === 'vid' ? `<video src="${item.url}" controls></video>` : ''}
            <button class="btn del" style="background:#ff6b8b;margin-top:10px" onclick="delPost(${i})">åˆ é™¤</button>
        </div>
        `;
    });
    document.getElementById('postsList').innerHTML = html;
}

function delPost(i) {
    posts.splice(i, 1);
    localStorage.setItem('posts', JSON.stringify(posts));
    renderPosts();
}

function renderMessages() {
    let html = '';
    messages.forEach(m => {
        const time = new Date(m.time).toLocaleString();
        html += `
        <div class="message-item">
            <div class="message-text">${m.text}</div>
            <div class="message-time">${time}</div>
        </div>
        `;
    });
    document.getElementById('messagesList').innerHTML = html || '<p>æš‚æ— æ¶ˆæ¯</p >';
}

// åˆå§‹åŒ–
document.getElementById('name').value = user.name || '';
document.getElementById('height').value = user.height || '';
document.getElementById('age').value = user.age || '';
document.getElementById('size').value = user.size || '';
renderPosts();
</script>
</body>
</html>
