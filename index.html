<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>æˆ‘çš„å°ç©ºé—´</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:PingFang SC,Helvetica Neue,sans-serif}
        :root{--bg:#fdf6fb;--card:#fff;--text:#444;--sub:#999;--main:#ff8fb7;--tag:#ffe0f0;--tagtext:#ff5a95}
        body{background:var(--bg);color:var(--text);padding:20px 15px 60px}
        .card{background:var(--card);border-radius:16px;padding:18px;margin-bottom:14px}
        .profile{text-align:center}
        .avatar{width:90px;height:90px;border-radius:50%;object-fit:cover;margin-bottom:10px}
        .name{font-size:20px;font-weight:700;margin-bottom:8px}
        .tags{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:10px}
        .tag{background:var(--tag);color:var(--tagtext);padding:4px 9px;border-radius:12px;font-size:12px}
        .info-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f0f0f0}
        .info-label{color:var(--sub)}
        .title{font-size:16px;font-weight:700;margin-bottom:12px;color:var(--main)}
        .post img,.post video{width:100%;border-radius:12px;margin-top:8px}
        .post{margin-bottom:12px}
        .like-bar{display:flex;align-items:center;gap:10px;margin-top:10px;font-size:14px;color:#666}
        .like{color:var(--main);cursor:pointer}
        .comment-box{margin-top:10px}
        .comment-input{width:100%;padding:8px;border:1px solid #ddd;border-radius:8px;margin-top:6px}
        .comment-item{font-size:13px;color:#555;margin-top:6px;padding-left:4px}
        .countdown{font-size:12px;color:var(--main);margin-top:6px}
        #imgViewer{position:fixed;inset:0;background:#000000e6;display:none;place-items:center;z-index:999}
        #viewerImg{max-width:90%;max-height:90vh;border-radius:12px}
    </style>
</head>
<body>

<div class="card profile">
    < img class="avatar" id="avatar">
    <div class="name" id="name"></div>
    <div class="tags" id="tags"></div>
</div>

<div class="card">
    <div class="info-row">
        <span class="info-label">èº«é«˜</span>
        <span id="height">--</span>
    </div>
    <div class="info-row">
        <span class="info-label">ä½“é‡</span>
        <span id="weight">--</span>
    </div>
    <div class="info-row">
        <span class="info-label">å°ºå¯¸</span>
        <span id="size">--</span>
    </div>
    < img id="sizeImg" style="width:100%;border-radius:12px;margin-top:12px;display:none">
</div>

<div class="card">
    <div class="title">ğŸ“ åŠ¨æ€</div>
    <div id="posts"></div>
</div>

<div class="card">
    <div class="title">ğŸ”’ é™æ—¶ç§æˆ¿</div>
    <div id="privates"></div>
</div>

<div id="imgViewer" onclick="closeViewer()">
    < img id="viewerImg">
</div>

<script>
// ä» localStorage è¯»å–æ•°æ®
let user = JSON.parse(localStorage.getItem('user')) || {};
let posts = JSON.parse(localStorage.getItem('posts')) || [];
let privates = JSON.parse(localStorage.getItem('private')) || [];

// åˆå§‹åŒ–é¡µé¢
initPage();

function initPage() {
    // 1. å¡«å……ä¸ªäººèµ„æ–™
    document.getElementById('avatar').src = user.avatar || '';
    document.getElementById('name').innerText = user.name || 'å°å¯çˆ±';
    document.getElementById('height').innerText = user.height || '--';
    document.getElementById('weight').innerText = user.weight || '--';
    document.getElementById('size').innerText = user.size || '--';

    if (user.sizeImg) {
        const sizeImgEl = document.getElementById('sizeImg');
        sizeImgEl.src = user.sizeImg;
        sizeImgEl.style.display = 'block';
    }

    // 2. æ¸²æŸ“æ ‡ç­¾
    let tagHtml = '';
    (user.style || []).forEach(t => {
        tagHtml += `<span class="tag">${t}</span>`;
    });
    document.getElementById('tags').innerHTML = tagHtml;

    // 3. æ¸²æŸ“åŠ¨æ€å’Œç§æˆ¿å†…å®¹
    renderPosts();
    renderPrivates();
}

// æ¸²æŸ“åŠ¨æ€åˆ—è¡¨
function renderPosts() {
    const postsContainer = document.getElementById('posts');
    postsContainer.innerHTML = '';

    posts.forEach((post, index) => {
        const postEl = document.createElement('div');
        postEl.className = 'post card';

        // æ–‡æœ¬å†…å®¹
        if (post.txt) {
            const textEl = document.createElement('div');
            textEl.innerText = post.txt;
            postEl.appendChild(textEl);
        }

        // å›¾ç‰‡æˆ–è§†é¢‘
        if (post.type === 'img' && post.url) {
            const imgEl = document.createElement('img');
            imgEl.src = post.url;
            imgEl.onclick = () => view(imgEl);
            postEl.appendChild(imgEl);
        } else if (post.type === 'vid' && post.url) {
            const videoEl = document.createElement('video');
            videoEl.src = post.url;
            videoEl.controls = true;
            postEl.appendChild(videoEl);
        }

        // ç‚¹èµå’Œè¯„è®ºæ 
        const likeBar = document.createElement('div');
        likeBar.className = 'like-bar';

        const likeBtn = document.createElement('div');
        likeBtn.className = 'like';
        likeBtn.innerText = post.like ? 'â¤ï¸ å·²ç‚¹èµ' : 'ğŸ¤ ç‚¹èµ';
        likeBtn.onclick = () => toggleLike(index);
        likeBar.appendChild(likeBtn);

        const commentLabel = document.createElement('div');
        commentLabel.innerText = 'è¯„è®º';
        likeBar.appendChild(commentLabel);
        postEl.appendChild(likeBar);

        // è¯„è®ºåŒº
        const commentBox = document.createElement('div');
        commentBox.className = 'comment-box';

        const commentInput = document.createElement('input');
        commentInput.className = 'comment-input';
        commentInput.id = `commentInput${index}`;
        commentInput.placeholder = 'è¯´ç‚¹ä»€ä¹ˆ...';
        commentBox.appendChild(commentInput);

        const sendBtn = document.createElement('button');
        sendBtn.className = 'btn';
        sendBtn.style = 'padding:6px;width:100%;margin-top:4px;background:var(--main);color:#fff;border:none;border-radius:8px';
        sendBtn.innerText = 'å‘é€';
        sendBtn.onclick = () => addComment(index);
        commentBox.appendChild(sendBtn);

        // è¯„è®ºåˆ—è¡¨
        const commentsList = document.createElement('div');
        commentsList.id = `comments${index}`;
        (post.comments || []).forEach(c => {
            const commentItem = document.createElement('div');
            commentItem.className = 'comment-item';
            commentItem.innerText = `â€¢ ${c}`;
            commentsList.appendChild(commentItem);
        });
        commentBox.appendChild(commentsList);

        postEl.appendChild(commentBox);
        postsContainer.appendChild(postEl);
    });
}

// æ¸²æŸ“ç§æˆ¿å†…å®¹
function renderPrivates() {
    const privatesContainer = document.getElementById('privates');
    privatesContainer.innerHTML = '';

    // è¿‡æ»¤è¿‡æœŸå†…å®¹
    const activePrivates = privates.filter(p => p.exp > Date.now());

    activePrivates.forEach(p => {
        const privateEl = document.createElement('div');
        privateEl.className = 'private card';

        if (p.type === 'img' && p.url) {
            const imgEl = document.createElement('img');
            imgEl.src = p.url;
            imgEl.onclick = () => view(imgEl);
            privateEl.appendChild(imgEl);
        } else if (p.type === 'vid' && p.url) {
            const videoEl = document.createElement('video');
            videoEl.src = p.url;
            videoEl.controls = true;
            privateEl.appendChild(videoEl);
        }

        // å€’è®¡æ—¶
        const left = p.exp - Date.now();
        const h = Math.floor(left / 3600000);
        const m = Math.floor((left % 3600000) / 60000);
        const countdownEl = document.createElement('div');
        countdownEl.className = 'countdown';
        countdownEl.innerText = `å‰©ä½™ ${h}æ—¶${m}åˆ†`;
        privateEl.appendChild(countdownEl);

        privatesContainer.appendChild(privateEl);
    });
}

// åˆ‡æ¢ç‚¹èµçŠ¶æ€
function toggleLike(index) {
    posts[index].like = !posts[index].like;
    localStorage.setItem('posts', JSON.stringify(posts));
    renderPosts();
}

// æ·»åŠ è¯„è®º
function addComment(index) {
    const input = document.getElementById(`commentInput${index}`);
    const val = input.value.trim();
    if (!val) return;

    if (!posts[index].comments) posts[index].comments = [];
    posts[index].comments.push(val);
    localStorage.setItem('posts', JSON.stringify(posts));
    input.value = '';
    renderPosts();
}

// æŸ¥çœ‹å¤§å›¾
function view(img) {
    document.getElementById('viewerImg').src = img.src;
    document.getElementById('imgViewer').style.display = 'grid';
}

// å…³é—­æŸ¥çœ‹å™¨
function closeViewer() {
    document.getElementById('imgViewer').style.display = 'none';
}
</script>
</body>
</html>
